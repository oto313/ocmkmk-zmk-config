/*
 * OCDMK Shield - Shared Configuration
 * 7 columns × 4 rows split keyboard matrix
 */

#include <dt-bindings/zmk/matrix_transform.h>

#include "ocdmk-layouts.dtsi"

/ {
    chosen {
        zmk,physical-layout = &default_layout;
        zmk,kscan = &kscan;
        zmk,matrix-transform = &default_transform;
        
        /*
         * WIRED SPLIT: Uncomment the line below when using CONFIG_ZMK_SPLIT_SERIAL=y
         * This enables UART communication between keyboard halves via pins 13/14 (TX/RX)
         */
        // zmk,split-serial = &ocdmk_core_serial;
    };

    /*
     * Charging Status LED Indicator
     * STAT1/STAT2 from ocdmk_charger nexus (defined in ocdmk_core_pins.dtsi)
     * led-gpios is overridden in left/right overlays due to PCB mirroring
     */
    charging_led: charging_indicator {
        compatible = "zmk,indicator-led";
        stat1-gpios = <&ocdmk_charger 0 GPIO_ACTIVE_HIGH>;  /* STAT1: P0.00 */
        stat2-gpios = <&ocdmk_charger 1 GPIO_ACTIVE_HIGH>;  /* STAT2: P0.31 */
        /* led-gpios defined in left/right overlays */
    };

    kscan: kscan {
        compatible = "zmk,kscan-gpio-matrix";
        diode-direction = "col2row";
        wakeup-source;
        /* Row and column gpios defined in left/right overlays due to PCB mirroring */
    };

    default_transform: default_transform {
        compatible = "zmk,matrix-transform";
        columns = <14>;  /* 7 cols × 2 halves */
        rows = <4>;

        /*
         * Split keyboard matrix layout (44 keys total)
         * Left side: columns 0-6 (22 keys)
         * Right side: columns 7-13 (22 keys, mirrored)
         *
         * Physical layout:
         * R1: [--][C1][C2][C3][C4][C5][--]  |  [--][C5][C4][C3][C2][C1][--]
         * R2: [C0][C1][C2][C3][C4][C5][C6]  |  [C6][C5][C4][C3][C2][C1][C0]
         * R3: [C0][C1][C2][C3][C4][C5][C6]  |  [C6][C5][C4][C3][C2][C1][C0]
         * R4: [C0][C1][C2][--][--][--][--]  |  [--][--][--][--][C2][C1][C0]
         */
        map = <
                RC(0,1) RC(0,2) RC(0,3) RC(0,4) RC(0,5)                     RC(0,12) RC(0,11) RC(0,10) RC(0,9) RC(0,8)
            RC(1,0) RC(1,1) RC(1,2) RC(1,3) RC(1,4) RC(1,5) RC(1,6)    RC(1,13) RC(1,12) RC(1,11) RC(1,10) RC(1,9) RC(1,8) RC(1,7)
            RC(2,0) RC(2,1) RC(2,2) RC(2,3) RC(2,4) RC(2,5) RC(2,6)    RC(2,13) RC(2,12) RC(2,11) RC(2,10) RC(2,9) RC(2,8) RC(2,7)
            RC(3,0) RC(3,1) RC(3,2)                                                                     RC(3,11) RC(3,10) RC(3,9)
        >;
    };
};
