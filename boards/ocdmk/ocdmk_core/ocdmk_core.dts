/*
 * Copyright (c) 2024 OCDMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

/dts-v1/;
#include <nordic/nrf52833_qiaa.dtsi>
#include "ocdmk_core_pins.dtsi"
#include "ocdmk_core-pinctrl.dtsi"

/ {
    model = "OCDMK Core";
    compatible = "ocdmk,core";

    chosen {
        zephyr,code-partition = &code_partition;
        zephyr,sram = &sram0;
        zephyr,flash = &flash0;
        zephyr,console = &uart0;
    };

    leds {
        compatible = "gpio-leds";
        /* LED PWM control for MCP1662 boost driver on P0.30 */
        led_backlight: led_0 {
            gpios = <&gpio0 30 GPIO_ACTIVE_HIGH>;
            label = "Backlight LED";
        };
    };

    pwmleds {
        compatible = "pwm-leds";
        pwm_led0: pwm_led_0 {
            pwms = <&pwm0 0 PWM_MSEC(10) PWM_POLARITY_NORMAL>;
        };
    };

    /* Aliases for common usage */
    aliases {
        led0 = &led_backlight;
        pwm-led0 = &pwm_led0;
    };
};

&reg1 {
    regulator-initial-mode = <NRF5X_REG_MODE_DCDC>;
};

&adc {
    status = "okay";
};

&gpiote {
    status = "okay";
};

&gpio0 {
    status = "okay";
};

&gpio1 {
    status = "okay";
};

&pwm0 {
    status = "okay";
    pinctrl-0 = <&pwm0_default>;
    pinctrl-1 = <&pwm0_sleep>;
    pinctrl-names = "default", "sleep";
};

/* UART with node label for interconnect */
ocdmk_core_serial: &uart0 {
    compatible = "nordic,nrf-uarte";
    status = "okay";
    current-speed = <115200>;
    pinctrl-0 = <&uart0_default>;
    pinctrl-1 = <&uart0_sleep>;
    pinctrl-names = "default", "sleep";
};

/* I2C with node label for interconnect */
ocdmk_core_i2c: &i2c0 {
    compatible = "nordic,nrf-twi";
    pinctrl-0 = <&i2c0_default>;
    pinctrl-1 = <&i2c0_sleep>;
    pinctrl-names = "default", "sleep";
};

/* SPI with node label for interconnect */
ocdmk_core_spi: &spi1 {
    compatible = "nordic,nrf-spim";
    status = "disabled";
};

zephyr_udc0: &usbd {
    status = "okay";
};

&flash0 {
    partitions {
        compatible = "fixed-partitions";
        #address-cells = <1>;
        #size-cells = <1>;

        /* 
         * nRF52833: 512KB flash
         * Using Adafruit nRF52 Bootloader layout
         */
        sd_partition: partition@0 {
            reg = <0x00000000 0x00001000>;
            label = "mbr";
        };

        code_partition: partition@1000 {
            reg = <0x00001000 0x0006b000>;
            label = "code_partition";
        };

        storage_partition: partition@6c000 {
            reg = <0x0006c000 0x00008000>;
            label = "storage";
        };

        boot_partition: partition@74000 {
            reg = <0x00074000 0x0000c000>;
            label = "adafruit_boot";
        };
    };
};

